---
import "../styles/loader.scss";
---
<section class="container mx-auto text-center py-6 mb-12">
    <h2 class="w-full my-2 text-5xl font-bold leading-tight text-center text-white">
      Alaturate noua
    </h2>
    <div class="w-full mb-4">
      <div class="h-1 mx-auto bg-white w-1/6 opacity-25 my-0 py-0 rounded-t"></div>
    </div>
    <div class="relative">
      <form id="userForm" class="bg-white max-w-md mx-3 sm:mx-auto rounded-3xl p-5">
          <div class="grid md:grid-cols-2 md:gap-6">
              <div class="relative z-0 w-full mb-5 group">
                  <input type="text" name="first_name" id="first_name" class="autofill-bg block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none  focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
                  <label for="first_name" class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 left-0 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">First name</label>
              </div>
              <div class="relative z-0 w-full mb-5 group">
                  <input type="text" name="last_name" id="last_name" class="autofill-bg block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none  focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
                  <label for="last_name" class="peer-focus:font-medium absolute text-sm text-gray-500  duration-300 transform -translate-y-6 scale-75 left-0 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600  peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Last name</label>
              </div>
            </div>
          <div class="relative z-0 w-full mb-5 group">
              <input type="email" name="email" id="email" class="autofill-bg block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none  focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
              <label for="email" class="peer-focus:font-medium absolute text-sm text-gray-500  duration-300 transform -translate-y-6 scale-75 left-0 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto peer-focus:text-blue-600  peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Email address</label>
          </div>
          <div class="relative z-0 w-full mb-5 group">
              <input type="text" name="clasa" id="clasa" class="autofill-bg block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none  focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
              <label for="clasa" class="peer-focus:font-medium absolute text-sm text-gray-500  duration-300 transform -translate-y-6 scale-75 left-0 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600  peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Clasa</label>
          </div>
          <div class="relative z-0 w-full mb-5 group">
              <div class="absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none">
                  <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                  </svg>
              </div>
              <input datepicker type="text" name="birthday_date" id="birthday_date" class="autofill-bg block ps-10 py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder="" required />
              <label for="birthday_date" class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 left-10 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Data nasterii </label>
          </div>  
          <div class="grid md:grid-cols-2 md:gap-6">
            <div class="relative z-0 w-full mb-5 group">
                <input type="tel" name="phonenumber" id="phonenumber" class="autofill-bg block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none  focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
                <label for="phonenumber" class="peer-focus:font-medium absolute text-sm text-gray-500  duration-300 transform -translate-y-6 scale-75 left-0 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600  peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Nr telefon</label>
            </div>
            <div class="relative z-0 w-full mb-5 group">
              <input type="tel" name="phonenumber_parents" id="phonenumber_parents" class="autofill-bg block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none  focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " />
              <label for="phonenumber_parents" class="peer-focus:font-medium absolute text-sm text-gray-500  duration-300 transform -translate-y-6 scale-75 left-0 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600  peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Nr telefon al parintelui</label>
            </div>     
          </div>
          <button id="submit" type="submit" class="text-white bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm w-auto px-5 py-2.5 text-center ">Submit</button>
        </form>
        <div id="loader" class="absolute -top-72 z-30"></div>
    </div>  
</section>

<script>
window.addEventListener('DOMContentLoaded', (event) => {
    const form = document.getElementById('userForm');
    const loader = document.getElementById('loader');
    const submitButton = document.getElementById('submit');
    
    if (form instanceof HTMLFormElement) {
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission
            form.classList.add('bg-gray-600', 'blur-xs')
            form.classList.remove('bg-white')
            loader?.classList.add('loader')
            submitButton?.setAttribute('disabled', 'true');

            var formData = new FormData(form);
            var object: { [key: string]: FormDataEntryValue } = {};
            formData.forEach((value, key) => { object[key] = value; });
            var json = JSON.stringify(object);
            fetch('https://script.google.com/macros/s/AKfycbwzZXuqAgrFBs9IY993bzgyaJYCyjemu9sqxAYdPjEXlbUU3v3b2YCXa38G992Ton3E/exec', {
                redirect: "follow",  
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8'
                },
                body: json
              }).then((response) => {
                  form.classList.add('bg-white')
                  form.classList.remove('bg-gray-600', 'blur-xs')
                  loader?.classList.remove('loader')
                  submitButton?.removeAttribute('disabled');
                  if (response.ok) {
                      return response.json();
                  } else {
                      throw new Error('Network response was not ok.');
                  }
              }).then(data => {
                    if (data.status === 'success') {
                      showAlert('Success! You have signed up.', 'green');
                      form.reset();
                      window.scrollTo({ top: 0, left: 0, behavior: 'smooth' });
                  } else {
                      showAlert('Error: ' + data.message, 'red');
                  }
              }).catch(error => {
                  showAlert('Error: Unable to submit the form.', 'red');
              });
        });
    }
});

function showAlert(message: string, color: string) {
    var alertBox = document.createElement('div');
    var innerHTML = `
    <div id="alert-1" class="fixed top-6 right-1/2 translate-x-1/2 flex items-center p-4 mb-4 text-${color}-800 rounded-lg bg-${color}-200" role="alert">
      <svg class="flex-shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
      </svg>
      <span class="sr-only">Info</span> 
      <div class="ms-3 text-sm font-medium">
        ${message}
      </div>
        <button type="button" class="ms-auto -mx-1.5 -my-1.5 bg-${color}-200 text-${color}-500 rounded-lg focus:ring-2 focus:ring-${color}-400 p-1.5 hover:bg-${color}-400 inline-flex items-center justify-center h-8 w-8 data-dismiss-target="#alert-1" aria-label="Close">
          <span class="sr-only">Close</span>
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
          </svg>
      </button>
    </div>
    `;

    alertBox.innerHTML = innerHTML;
    document.body.appendChild(alertBox);
    const closeButton = alertBox.querySelector('button[aria-label="Close"]');
    closeButton?.addEventListener('click', function() {
        alertBox.remove();
    });
}
</script>
  